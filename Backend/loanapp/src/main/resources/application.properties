# ==============================================================================
# SERVER & APP CONFIGURATION
# ==============================================================================
# Render dynamically assigns a port. If not found, defaults to 8080 locally.
server.port=${PORT:8080}
spring.application.name=loanapp

# ==============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# ==============================================================================
# Replace 'localhost:5433/loanpap' with your local DB details.
# On Render, provide the 'Internal Database URL' in the SPRING_DATASOURCE_URL variable.
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5433/loanpap}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=5

# ==============================================================================
# JPA / HIBERNATE SETTINGS
# ==============================================================================
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ==============================================================================
# FLYWAY MIGRATION
# ==============================================================================
spring.flyway.enabled=false
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true

# ==============================================================================
# SECURITY & JWT
# ==============================================================================
# Use a strong, random 64-character string for JWT_SECRET on Render.
application.security.jwt.secret-key=${JWT_SECRET}
application.security.jwt.expiration=86400000
application.security.jwt.refresh-token.expiration=604800000

# CORS: Add your live React URL (e.g., https://my-app.onrender.com) to FRONTEND_URL
security.allowed-origins=http://localhost:5173,http://localhost:3000,${FRONTEND_URL}
security.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
security.allowed-headers=*

# ==============================================================================
# EMAIL CONFIGURATION (Gmail SMTP)
# ==============================================================================
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true

# ==============================================================================
# M-PESA DARAJA API CONFIGURATION
# ==============================================================================
mpesa.consumer.key=${MPESA_CONSUMER_KEY}
mpesa.consumer.secret=${MPESA_CONSUMER_SECRET}
mpesa.passkey=${MPESA_PASSKEY}
mpesa.shortcode=${MPESA_SHORTCODE:174379}
# This MUST be your backend's public Render URL
mpesa.callback.url=${MPESA_CALLBACK_URL}

# ==============================================================================
# BUSINESS LOGIC SETTINGS
# ==============================================================================
app.credit-score.min=300
app.credit-score.max=850
app.interest-rates.base=6.5
app.interest-rates.risk-multiplier=0.1
app.loan.max-term-months=84
app.loan.max-amount=100000

# ==============================================================================
# LOGGING & TEMPLATES
# ==============================================================================
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
logging.level.com.example.loanapp=INFO
logging.level.org.springframework.security=INFO